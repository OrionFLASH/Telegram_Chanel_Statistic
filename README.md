# Telegram Channel Scanner

## Формулировка задачи и техническое задание

### Задача
Создать программу на Python для сканирования всех каналов и групп Telegram, в которых пользователь является участником или подписчиком. Программа должна собирать полную информацию о каждом канале, включая количество подписчиков, тип канала, описание и другие доступные данные.

### Техническое задание
1. **Сканирование каналов**: Программа должна просканировать все каналы, группы и супергруппы, в которых пользователь является участником
2. **Сбор информации**: Для каждого канала собрать:
   - Название канала
   - ID канала
   - Username (если есть)
   - Тип (канал, группа, супергруппа)
   - Количество участников/подписчиков
   - Описание канала
   - Публичность (публичный/приватный)
   - Ссылка на канал
   - Дата создания (если доступна)
3. **Сохранение результатов**: Результаты сохраняются в двух форматах:
   - JSON файл для программной обработки
   - Текстовый файл для удобного чтения
4. **Логирование**: Подробное логирование всех операций с двумя уровнями детализации
5. **Безопасность**: Использование .env файла для хранения секретных данных (API ключи)

## Подробное описание решения

Программа использует библиотеку **Telethon** для работы с Telegram API. Telethon является современной асинхронной библиотекой, которая не требует запуска серверной части и работает напрямую с Telegram API через MTProto протокол.

### Архитектура программы

Программа состоит из трех основных модулей:

1. **logger_config.py** - модуль настройки логирования
2. **channel_scanner.py** - модуль сканирования каналов
3. **main.py** - основной модуль программы

### Процесс работы

1. Загрузка конфигурации из `.env` файла
2. Создание и авторизация клиента Telegram
3. Получение списка всех диалогов пользователя
4. Фильтрация каналов и групп
5. Сбор детальной информации о каждом канале
6. Сохранение результатов в файлы

### Особенности реализации

- **Асинхронная работа**: Использование asyncio для эффективной работы с API
- **Обработка ошибок**: Корректная обработка лимитов API (FloodWaitError)
- **Безопасность**: Все секретные данные хранятся в .env файле, который исключен из git
- **Логирование**: Детальное логирование всех операций с указанием класса и функции

## Структура проекта

```
Telegram_Chanel_Statistic/
├── src/                    # Исходный код программы
│   ├── main.py            # Основной модуль программы
│   ├── channel_scanner.py  # Модуль сканирования каналов
│   ├── logger_config.py   # Модуль настройки логирования
│   └── Tests/             # Папка для тестов
├── log/                    # Папка для логов
├── Docs/                   # Дополнительная документация
├── .env                    # Файл с секретными данными (не в git)
├── .env.example            # Пример конфигурации
├── .gitignore             # Игнорируемые файлы
├── requirements.txt       # Зависимости проекта
└── README.md              # Документация проекта
```

## Полный список переменных и функций

### Модуль logger_config.py

#### Функции

**setup_logger(name: str, log_dir: str = "log") -> logging.Logger**
- **Назначение**: Создает и настраивает логгер с двумя уровнями детализации (INFO и DEBUG)
- **Параметры**:
  - `name`: Имя логгера (обычно имя модуля)
  - `log_dir`: Директория для хранения логов (по умолчанию 'log')
- **Возвращает**: Настроенный объект логгера
- **Пример использования**:
```python
logger = setup_logger("my_module")
logger.info("Информационное сообщение")
logger.debug("Отладочное сообщение")
```

**get_logger(name: str) -> logging.Logger**
- **Назначение**: Получает существующий логгер или создает новый
- **Параметры**:
  - `name`: Имя логгера
- **Возвращает**: Объект логгера
- **Пример использования**:
```python
logger = get_logger("my_module")
```

### Модуль channel_scanner.py

#### Класс ChannelScanner

**__init__(self, client: TelegramClient) -> None**
- **Назначение**: Инициализация сканера каналов
- **Параметры**:
  - `client`: Экземпляр TelegramClient для работы с API
- **Пример использования**:
```python
scanner = ChannelScanner(client)
```

**get_channel_info(self, entity: Channel) -> Optional[Dict[str, Any]]**
- **Назначение**: Получает детальную информацию о канале
- **Параметры**:
  - `entity`: Объект канала из Telegram API
- **Возвращает**: Словарь с информацией о канале или None в случае ошибки
- **Пример использования**:
```python
channel_info = await scanner.get_channel_info(channel_entity)
```

**scan_all_channels(self) -> List[Dict[str, Any]]**
- **Назначение**: Сканирует все каналы, группы и супергруппы пользователя
- **Возвращает**: Список словарей с информацией о каждом канале
- **Пример использования**:
```python
channels_data = await scanner.scan_all_channels()
```

**save_to_json(self, filename: str = "channels_data.json") -> None**
- **Назначение**: Сохраняет данные о каналах в JSON файл
- **Параметры**:
  - `filename`: Имя файла для сохранения
- **Пример использования**:
```python
scanner.save_to_json("my_channels.json")
```

**save_to_text(self, filename: str = "channels_list.txt") -> None**
- **Назначение**: Сохраняет данные о каналах в текстовый файл для удобного чтения
- **Параметры**:
  - `filename`: Имя файла для сохранения
- **Пример использования**:
```python
scanner.save_to_text("my_channels.txt")
```

#### Переменные класса

- `self.client: TelegramClient` - клиент для работы с Telegram API
- `self.logger: logging.Logger` - логгер для записи событий
- `self.channels_data: List[Dict[str, Any]]` - список данных о каналах

### Модуль main.py

#### Функции

**load_config() -> Tuple[Optional[str], Optional[str], Optional[str]]**
- **Назначение**: Загружает конфигурацию из файла .env
- **Возвращает**: Кортеж с API_ID, API_HASH и PHONE из конфигурации
- **Пример использования**:
```python
api_id, api_hash, phone = load_config()
```

**authenticate_client(client: TelegramClient, phone: str) -> None**
- **Назначение**: Выполняет аутентификацию клиента Telegram
- **Параметры**:
  - `client`: Экземпляр TelegramClient
  - `phone`: Номер телефона для входа
- **Пример использования**:
```python
await authenticate_client(client, "+79991234567")
```

**main() -> None**
- **Назначение**: Основная функция программы. Выполняет сканирование всех каналов и сохранение результатов
- **Пример использования**:
```python
asyncio.run(main())
```

## Установка и настройка

### Требования

- Python 3.8 или выше
- pip (менеджер пакетов Python)

### Шаги установки

1. **Создание виртуального окружения**:
```bash
cd ~/Desktop/MyProject/Telegram_Chanel_Statistic
python3 -m venv venv
source venv/bin/activate  # Для macOS/Linux
```

2. **Установка зависимостей**:
```bash
pip install -r requirements.txt
```

3. **Получение API ключей Telegram**:
   - Перейдите на https://my.telegram.org/apps
   - Войдите с вашим номером телефона
   - Создайте новое приложение
   - Скопируйте `api_id` и `api_hash`

4. **Настройка конфигурации**:
   - Скопируйте файл `.env.example` в `.env`:
   ```bash
   cp .env.example .env
   ```
   - Откройте `.env` и заполните данные:
   ```
   TELEGRAM_API_ID=ваш_api_id
   TELEGRAM_API_HASH=ваш_api_hash
   TELEGRAM_PHONE=+79991234567
   ```

## Использование программы

### Запуск программы

```bash
cd ~/Desktop/MyProject/Telegram_Chanel_Statistic
source venv/bin/activate  # Если виртуальное окружение не активировано
python src/main.py
```

### Процесс работы

1. При первом запуске программа запросит код подтверждения, который придет в Telegram
2. Если у вас включена двухфакторная аутентификация, программа запросит пароль
3. После авторизации начнется сканирование всех каналов
4. Результаты будут сохранены в файлы:
   - `channels_data.json` - данные в формате JSON
   - `channels_list.txt` - данные в текстовом формате

### Результаты работы

Программа создает два файла с результатами:

1. **channels_data.json** - структурированные данные в формате JSON, удобные для программной обработки
2. **channels_list.txt** - текстовый файл с форматированным списком всех каналов

### Логи

Все логи сохраняются в папке `log/` с именами файлов по шаблону:
- `INFO_telegram_scanner_YYYYMMDD_HH.log` - информационные логи
- `DEBUG_telegram_scanner_YYYYMMDD_HH.log` - отладочные логи

## История версий

### Версия 1.0.0 (2025-01-XX)

**Реализованный функционал:**
- Сканирование всех каналов и групп Telegram
- Сбор детальной информации о каждом канале:
  - Название, ID, username
  - Тип канала (канал, группа, супергруппа)
  - Количество участников/подписчиков
  - Описание канала
  - Публичность
  - Ссылка на канал
- Сохранение результатов в JSON и текстовый формат
- Подробное логирование с двумя уровнями детализации
- Использование .env для хранения секретных данных
- Обработка ошибок и лимитов API

**Решенные проблемы:**
- Настройка корректной работы с Telegram API через Telethon
- Реализация асинхронной работы для эффективного сканирования
- Обработка случаев, когда количество участников недоступно (требуются права администратора)
- Корректная обработка лимитов API (FloodWaitError)
- Настройка логирования с правильным форматом для DEBUG уровня

**Технические детали:**
- Использование библиотеки Telethon 1.34.0
- Python 3.8+ с поддержкой type hints
- Асинхронное программирование с asyncio
- Структурированное логирование с указанием класса и функции

## Примечания

- Программа работает без запуска серверной части, используя прямые запросы к Telegram API
- Для получения количества участников в некоторых каналах могут потребоваться права администратора
- При большом количестве каналов сканирование может занять продолжительное время
- Сессия Telegram сохраняется автоматически после первого входа, последующие запуски не требуют повторной авторизации

## Лицензия

Проект создан в образовательных целях.
